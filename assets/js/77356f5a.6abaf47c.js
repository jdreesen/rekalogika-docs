"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[881],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>h});var a=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var l=a.createContext({}),c=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},p=function(e){var t=c(e.components);return a.createElement(l.Provider,{value:t},e.children)},m="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,r=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),m=c(n),u=i,h=m["".concat(l,".").concat(u)]||m[u]||d[u]||r;return n?a.createElement(h,o(o({ref:t},p),{},{components:n})):a.createElement(h,o({ref:t},p))}));function h(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=n.length,o=new Array(r);o[0]=u;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[m]="string"==typeof e?e:i,o[1]=s;for(var c=2;c<r;c++)o[c]=n[c];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},5616:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>d,frontMatter:()=>r,metadata:()=>s,toc:()=>c});var a=n(7462),i=(n(7294),n(3905));const r={title:"Immediate Dispatcher Handling & Troubleshooting"},o=void 0,s={unversionedId:"domain-event/immediate-dispatcher",id:"domain-event/immediate-dispatcher",title:"Immediate Dispatcher Handling & Troubleshooting",description:"Immediate Dispatcher in Unit Tests",source:"@site/docs/domain-event/03-immediate-dispatcher.md",sourceDirName:"domain-event",slug:"/domain-event/immediate-dispatcher",permalink:"/domain-event/immediate-dispatcher",draft:!1,editUrl:"https://github.com/rekalogika/rekalogika-docs/edit/main/docs/domain-event/03-immediate-dispatcher.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{title:"Immediate Dispatcher Handling & Troubleshooting"},sidebar:"docs",previous:{title:"Manual Control",permalink:"/domain-event/manual-control"},next:{title:"Tips and Best Practices",permalink:"/domain-event/tips"}},l={},c=[{value:"Immediate Dispatcher in Unit Tests",id:"immediate-dispatcher-in-unit-tests",level:3}],p={toc:c},m="wrapper";function d(e){let{components:t,...n}=e;return(0,i.kt)(m,(0,a.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h3",{id:"immediate-dispatcher-in-unit-tests"},"Immediate Dispatcher in Unit Tests"),(0,i.kt)("p",null,"Immediate event dispatcher works by installing the event dispatcher to a static\nvariable. This installation happens on several opportunities:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"In these events: ",(0,i.kt)("inlineCode",{parentName:"li"},"kernel.request")," and ",(0,i.kt)("inlineCode",{parentName:"li"},"console.command"),"."),(0,i.kt)("li",{parentName:"ul"},"During the initialization of ",(0,i.kt)("inlineCode",{parentName:"li"},"ManagerRegistry"),"."),(0,i.kt)("li",{parentName:"ul"},"During the initialization of an ",(0,i.kt)("inlineCode",{parentName:"li"},"EntityManagerInterface"),".")),(0,i.kt)("p",null,"When any of these don't occur, there is no opportunity to install the event\ndispatcher. This usually happens only in isolated unit tests. To fix the\nproblem, you can install a stub event dispatcher manually like the following."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-php"},"use PHPUnit\\Framework\\TestCase;\nuse Rekalogika\\DomainEvent\\ImmediateDomainEventDispatcherInstaller;\nuse Symfony\\Component\\EventDispatcher\\EventDispatcher;\n\nclass SomeTest extends TestCase\n{\n    public function setUp(): void\n    {\n        $installer = new ImmediateDomainEventDispatcherInstaller(new EventDispatcher);\n        $installer->install();\n\n    }\n\n    // ...\n}\n")),(0,i.kt)("admonition",{type:"note"},(0,i.kt)("p",{parentName:"admonition"},"Stub dispatcher doesn't do anything. If you want to test the dispatching, you\nneed to get the real dispatcher from the container.")),(0,i.kt)("p",null,"In integration tests where you have access to the service container, but the\ntests don't involve ",(0,i.kt)("inlineCode",{parentName:"p"},"EntityManager")," or ",(0,i.kt)("inlineCode",{parentName:"p"},"ManagerRegistry"),", you can manually pull\nthe installer from the container to install the immediate dispatcher:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-php"},"use Rekalogika\\DomainEvent\\ImmediateDomainEventDispatcherInstaller;\nuse Symfony\\Bundle\\FrameworkBundle\\Test\\KernelTestCase;\n\nclass SomeTest extends KernelTestCase\n{\n    public function setUp(): void\n    {\n        self::bootKernel();\n        static::getContainer()\n          ->get(ImmediateDomainEventDispatcherInstaller::class)->install();\n    }\n\n    // ...\n}\n")))}d.isMDXComponent=!0}}]);