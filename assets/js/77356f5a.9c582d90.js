"use strict";(self.webpackChunkrekalogika_docs=self.webpackChunkrekalogika_docs||[]).push([[5881],{1768:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>m,frontMatter:()=>a,metadata:()=>r,toc:()=>c});var i=t(5893),s=t(1151);const a={title:"Immediate Dispatcher Handling & Troubleshooting"},o=void 0,r={id:"domain-event/immediate-dispatcher",title:"Immediate Dispatcher Handling & Troubleshooting",description:"Immediate Dispatcher in Unit Tests",source:"@site/docs/domain-event/03-immediate-dispatcher.md",sourceDirName:"domain-event",slug:"/domain-event/immediate-dispatcher",permalink:"/domain-event/immediate-dispatcher",draft:!1,unlisted:!1,editUrl:"https://github.com/rekalogika/rekalogika-docs/edit/main/docs/domain-event/03-immediate-dispatcher.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{title:"Immediate Dispatcher Handling & Troubleshooting"},sidebar:"docs",previous:{title:"Manual Control",permalink:"/domain-event/manual-control"},next:{title:"Tips and Caveats",permalink:"/domain-event/tips"}},l={},c=[{value:"Immediate Dispatcher in Unit Tests",id:"immediate-dispatcher-in-unit-tests",level:3}];function d(e){const n={admonition:"admonition",code:"code",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h3,{id:"immediate-dispatcher-in-unit-tests",children:"Immediate Dispatcher in Unit Tests"}),"\n",(0,i.jsx)(n.p,{children:"Immediate event dispatcher works by installing the event dispatcher to a static\nvariable. This installation happens on several opportunities:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["In these events: ",(0,i.jsx)(n.code,{children:"kernel.request"})," and ",(0,i.jsx)(n.code,{children:"console.command"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["During the initialization of ",(0,i.jsx)(n.code,{children:"ManagerRegistry"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["During the initialization of an ",(0,i.jsx)(n.code,{children:"EntityManagerInterface"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"If none of these occurs, there is no opportunity to install the event dispatcher.\nThis usually happens only in isolated unit tests. To fix the problem, you can\ninstall a stub event dispatcher manually like this."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"use PHPUnit\\Framework\\TestCase;\nuse Rekalogika\\DomainEvent\\ImmediateDomainEventDispatcherInstaller;\nuse Symfony\\Component\\EventDispatcher\\EventDispatcher;\n\nclass SomeTest extends TestCase\n{\n    public function setUp(): void\n    {\n        $installer = new ImmediateDomainEventDispatcherInstaller(new EventDispatcher);\n        $installer->install();\n\n    }\n\n    // ...\n}\n"})}),"\n",(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsx)(n.p,{children:"The stub dispatcher doesn't do anything. If you want to test the dispatching,\nyou need to get the real dispatcher from the container."})}),"\n",(0,i.jsxs)(n.p,{children:["In integration tests where you have access to the service container, but the\ntests don't involve ",(0,i.jsx)(n.code,{children:"EntityManager"})," or ",(0,i.jsx)(n.code,{children:"ManagerRegistry"}),", you can manually pull\nthe installer from the container to install the immediate dispatcher:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"use Rekalogika\\DomainEvent\\ImmediateDomainEventDispatcherInstaller;\nuse Symfony\\Bundle\\FrameworkBundle\\Test\\KernelTestCase;\n\nclass SomeTest extends KernelTestCase\n{\n    public function setUp(): void\n    {\n        self::bootKernel();\n        static::getContainer()\n          ->get(ImmediateDomainEventDispatcherInstaller::class)->install();\n    }\n\n    // ...\n}\n"})})]})}function m(e={}){const{wrapper:n}={...(0,s.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},1151:(e,n,t)=>{t.d(n,{Z:()=>r,a:()=>o});var i=t(7294);const s={},a=i.createContext(s);function o(e){const n=i.useContext(a);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),i.createElement(a.Provider,{value:n},e.children)}}}]);